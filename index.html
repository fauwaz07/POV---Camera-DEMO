<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>POV Camera App</title>
</head>
<body>
    <h1>Snap a Photo</h1>
    <input type="file" accept="image/*" capture="environment" id="cameraInput" multiple>
    <br>
    <button id="upload" disabled>⬆️ Upload</button>

    <script>
        const cameraInput = document.getElementById('cameraInput');
        const uploadBtn = document.getElementById('upload');
        let imagesToUpload = [];

        cameraInput.addEventListener("change", () => {
            imagesToUpload = []; // Clear previous session
            const files = cameraInput.files;

            if (!files.length) return;

            let processed = 0;

            for (let i = 0; i < files.length; i++) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const base64 = e.target.result.split(',')[1]; // remove base64 prefix
                    imagesToUpload.push({
                        filename: `photo_${Date.now()}_${i}.jpg`,
                        data: base64
                    });

                    processed++;
                    if (processed === files.length) {
                        uploadBtn.disabled = false;
                    }
                };
                reader.readAsDataURL(files[i]);
            }
        });

        uploadBtn.onclick = async () => {
            for (const img of imagesToUpload) {
                await fetch("https://script.google.com/macros/s/AKfycbxiDCyCuxW-CYnveelw_oHaKG2hEOfkJEjPeWG1si9jLLZWIpbrfsvS-3RM628UkXgRAQ/exec", {
                    method: "POST",
                    body: new URLSearchParams({
                        image: img.data,
                        filename: img.filename
                    })
                })
                    .then(res => res.text())
                    .then(txt => console.log("Uploaded:", img.filename, txt))
                    .catch(err => alert("Error uploading " + img.filename + ": " + err));
            }

            alert("All photos uploaded!");
            uploadBtn.disabled = true;
            cameraInput.value = ""; // Reset file input
        };
    </script>

</body>
</html>
